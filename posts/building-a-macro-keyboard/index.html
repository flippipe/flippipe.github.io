<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Building a Macro Keyboard | œú’¨◊ïœÅ Œ°Œπ—ÄŒµ</title><meta name=keywords content="keyboard"><meta name=description content="Building a macros keyboard from a conventional numeric keyboard"><meta name=author content="Filipe"><link rel=canonical href=https://flippipe.github.io/posts/building-a-macro-keyboard/><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://flippipe.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://flippipe.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://flippipe.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://flippipe.github.io/apple-touch-icon.png><link rel=mask-icon href=https://flippipe.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.100.1"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Building a Macro Keyboard"><meta property="og:description" content="Building a macros keyboard from a conventional numeric keyboard"><meta property="og:type" content="article"><meta property="og:url" content="https://flippipe.github.io/posts/building-a-macro-keyboard/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-05-23T22:15:43+00:00"><meta property="article:modified_time" content="2022-01-23T22:15:43+00:00"><meta property="og:site_name" content="œú’¨◊ïœÅ Œ°Œπ—ÄŒµ"><meta name=twitter:card content="summary"><meta name=twitter:title content="Building a Macro Keyboard"><meta name=twitter:description content="Building a macros keyboard from a conventional numeric keyboard"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://flippipe.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Building a Macro Keyboard","item":"https://flippipe.github.io/posts/building-a-macro-keyboard/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Building a Macro Keyboard","name":"Building a Macro Keyboard","description":"Building a macros keyboard from a conventional numeric keyboard","keywords":["keyboard"],"articleBody":"Introduction In the old times, when we had a physical phone, it was easy to answer a call, just pick the phone.\nSince the migration to software which substitue the phone, I want to recreate the workflow to answer a call: no need to find some button in some window just to answer a call.\nUsing a numeric keypad it is possible to replicate the workflow‚Ä¶ bind a key to answer the call, and more buttons, more actions we can automate.\nKeyboard First we need a dedicated keyboard for this function, and any keyboard should do.\nLaying arround I just have full size keyboard, so I bought a new MITSAI Q20 from a local shop.\nI like it, because the keys are squared and low profile. Easy to customize with stickers.\npluging keyboard the first time In systemd journal, you will find information about the keyboard. As you can see, the brand name from my local shop do not show up anywhere.\nkernel: usb 1-1.4.3: new low-speed USB device number 15 using xhci_hcd kernel: usb 1-1.4.3: New USB device found, idVendor=1a2c, idProduct=0e24, bcdDevice= 1.10 kernel: usb 1-1.4.3: New USB device strings: Mfr=1, Product=2, SerialNumber=0 kernel: usb 1-1.4.3: Product: USB Keyboard kernel: usb 1-1.4.3: Manufacturer: SEM kernel: input: SEM USB Keyboard as /devices/pci0000:00/0000:00:14.0/usb1/1-1/1-1.4/1-1.4.3/1-1.4.3:1.0/0003:1A2C:0E24.000B/input/input29 kernel: hid-generic 0003:1A2C:0E24.000B: input,hidraw5: USB HID v1.10 Keyboard [SEM USB Keyboard] on usb-0000:00:14.0-1.4.3/input0 System configuration udev udev will allow us to do some setup and start actkbd service.\nMy udev rule file is:\nACTION==\"add\", \\ # match the event, device and parent device SUBSYSTEM==\"input\", \\ ATTRS{name}==\"SEM USB Keyboard\", \\ MODE=\"0666\", \\ # set mode to other read from the device, without root SYMLINK+=\"macrokeyboard\", \\ # create a nicer symbolic link TAG+=\"systemd\", \\ # this will used systemd to start actkbd ENV{SYSTEMD_USER_WANTS}=\"actkbd.service\" To reload the configuration, we can use\nudevadm control --reload-rules To check if the udev rule file is working\nudevadm test /devices/pci0000:00/0000:00:14.0/usb1/1-1/1-1.4/1-1.4.3/1-1.4.3:1.0/0003:1A2C:0E24.000B/input/input29 To create an udev rule can be hit and miss. Doing the wrong filters, can lead to diferent devices be found, but is is possible to get all information\nudevadm info --attribute-walk --path /devices/pci0000:00/0000:00:14.0/usb1/1-1/1-1.4/1-1.4.3/1-1.4.3:1.0/0003:1A2C:0E24.000B/input/input29 In case of problems, read Writing udev rules to learn how to write it.\nsystemd As configured in udev rule, this unit will start the service.\n[Unit] Description=Actkbd: Daemon for X-independent shortcuts ConditionPathIsSymbolicLink=/dev/macrokeyboard [Service] Environment=DISPLAY=:0 ExecStart=actkbd --device /dev/macrokeyboard --daemon --pidfile /tmp/actkbd.pid Type=forking PIDFile=/tmp/actkbd.pid Restart=on-failure RestartSec=1 X Without instrcut XOrg to ignore this numeric keypad, when we press a key, it will send that key code the application.\nSo we need to place a file in /usr/share/X11/xorg.conf.d/, with:\nSection \"InputClass\" Identifier \"Ignore macro keyboard\" MatchProduct \"SEM USB Keyboard\" Option \"Ignore\" \"on\" EndSection To test this, it is needed to restart X server‚Ä¶\nactkbd Warning, by project author:\n‚Ä¶but here‚Äôs the catch: actkbd (a) is single-threaded and (b) uses system() in the same thread to execute commands. Yes, I know, not nice; the whole program is basically a hack - it just worked well enough for me and a few friends back when I wrote it.\nIt can be an hack, but actkbd have work without problems for me.\nAfter installation we need to find the keycodes from our keyboard.\nKeyCodes I‚Äôve found two ways to do it‚Ä¶\nusing actkbd\n$ actkbd --showexec --showkey --noexec --device /dev/macrokeyboard Keys: 79 Keys: 80 Keys: 81 Keys: 96 or using showkeys\n$ sudo showkey press any key (program terminates 10s after last keypress)... keycode 28 release keycode 79 press keycode 79 release keycode 80 press keycode 80 release configuration The default location for the configuration file is /etc/actkbd.conf\nI opted by send all keycodes to a single script‚Ä¶\n#1st line 172:::/usr/bin/keyboardScript.sh 172 \u0026 15:::/usr/bin/keyboardScript.sh 15 \u0026 155:::/usr/bin/keyboardScript.sh 155 \u0026 140:::/usr/bin/keyboardScript.sh 140 \u0026 Each line can execute any command, but I decided to have a script which will deal with all of it‚Ä¶ it is easier to reuse code and maintain it. Also, I can change the script without to bother to restart actkbd to reload new actions.\ntesting actkbd --showexec --showkey --device /dev/macrokeyboard It should show somethig like\nKeys: 76 Executing: /home/fcarvalho/bin/keyboardScript.sh 76 \u0026 Keys: 69 Executing: /home/fcarvalho/bin/keyboardScript.sh 69 \u0026 The Script My script, is a giant case, something like:\ncase $1 in 79) # xdotool key U1f600 xdotool type üòÄ # slow https://github.com/jordansissel/xdotool/issues/10 ;; 71) mpc status | grep playing 2\u003e\u00261 \u003e /dev/null if [ $? -eq 0 ]; then # it is playing mpc --quiet stop dbusSend Pause else mpc --quiet play dbusSend Play fi ;; 76) # take a area screenshot flameshot gui \u0026 ;; (...) and several tools were used\nxdotool Without xdotool it cloud not do the automations.\nxdotool lets us programmatically simulate keyboard input and mouse.\nAs example, pressing a key to toggle video in MS Teams.\n82) # mute unmute video WID=$(xdotool search --onlyvisible --name \"Microsoft Teams\") ‚ë† if [ $WID ]; then xdotool windowfocus --sync $WID ‚ë° xdotool key --window $WID \"ctrl+shift+o\" ‚ë¢ fi ;; where:\n‚ë† Search for Teams window ‚ë° Put the window on focus ‚ë¢ Send the Teams shortcut to Toggle video mpc My music is streamed from other machine, where I‚Äôve mpd running, so I use mpc to control it remotelly.\ndbus dbus-send + MPRIS allow to abstract which music player I‚Äôm using, as long as they support it.\nnote use d-feet to explore dbus\nFinal Result Besides the software, the final touch was to print in photo papper some nice icons. Then with double face tape and a scissor, convert them to little stickers.\nAll the files are in Building a macro keyboard.\nFuture Most of this work was done with xdotool, on top X‚Ä¶ which is being substituted by Wayland.\nSo, it is time to look into xdotool replacement options:\nhttps://github.com/ReimuNotMoe/ydotool https://github.com/atx/wtype other resources Font Awesome or Nerd Fonts\nScripting with udev\nService unit configuration\n","wordCount":"963","inLanguage":"en","datePublished":"2020-05-23T22:15:43Z","dateModified":"2022-01-23T22:15:43Z","author":{"@type":"Person","name":"Filipe"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://flippipe.github.io/posts/building-a-macro-keyboard/"},"publisher":{"@type":"Organization","name":"œú’¨◊ïœÅ Œ°Œπ—ÄŒµ","logo":{"@type":"ImageObject","url":"https://flippipe.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=https://flippipe.github.io accesskey=h title="œú’¨◊ïœÅ Œ°Œπ—ÄŒµ (Alt + H)">œú’¨◊ïœÅ Œ°Œπ—ÄŒµ</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://flippipe.github.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://flippipe.github.io/sticky-notes/ title=notes><span>notes</span></a></li><li><a href=https://flippipe.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://flippipe.github.io/mix/playlist/ title=üéß><span>üéß</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://flippipe.github.io>Home</a>&nbsp;¬ª&nbsp;<a href=https://flippipe.github.io/posts/>Posts</a></div><h1 class=post-title>Building a Macro Keyboard</h1><div class=post-description>Building a macros keyboard from a conventional numeric keyboard</div><div class=post-meta><span title='2020-05-23 22:15:43 +0000 UTC'>23 May 2020</span>&nbsp;¬∑&nbsp;5 min&nbsp;¬∑&nbsp;Filipe&nbsp;|&nbsp;<a href=https://github.com/flippipe/flippipe.github.io/blob/master/content/posts/Building%20a%20macro%20keyboard.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a><ul><li><a href=#keyboard aria-label=Keyboard>Keyboard</a></li><li><a href=#pluging-keyboard-the-first-time aria-label="pluging keyboard the first time">pluging keyboard the first time</a></li></ul></li><li><a href=#system-configuration aria-label="System configuration">System configuration</a><ul><li><a href=#udev aria-label=udev>udev</a></li><li><a href=#systemd aria-label=systemd>systemd</a></li><li><a href=#x aria-label=X>X</a></li><li><a href=#actkbd aria-label=actkbd>actkbd</a><ul><li><a href=#keycodes aria-label=KeyCodes>KeyCodes</a></li><li><a href=#configuration aria-label=configuration>configuration</a></li><li><a href=#testing aria-label=testing>testing</a></li></ul></li></ul></li><li><a href=#the-script aria-label="The Script">The Script</a><ul><li><a href=#xdotool aria-label=xdotool>xdotool</a></li><li><a href=#mpc aria-label=mpc>mpc</a></li><li><a href=#dbus aria-label=dbus>dbus</a></li></ul></li><li><a href=#final-result aria-label="Final Result">Final Result</a></li><li><a href=#future aria-label=Future>Future</a><ul><ul><ul><li><a href=#other-resources aria-label="other resources">other resources</a></li></ul></ul></ul></li></ul></div></details></div><div class=post-content><h1 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h1><p>In the old times, when we had a physical phone, it was easy to answer a call, just pick the phone.</p><p>Since the migration to software which substitue the phone, I want to recreate the workflow to answer a call: no need to find some button in some window just to answer a call.</p><p><a href=https://medium.com/@kenneth.skertchly/using-a-numeric-keypad-as-a-hotkey-pad-in-linux-6a487d624d75>Using a numeric keypad</a> it is possible to replicate the workflow&mldr; bind a key to answer the call, and more buttons, more actions we can automate.</p><figure class=align-center><img loading=lazy src="https://github.com/flippipe/macro-keyboard/blob/main/final%20product.png?raw=true#center" height=250></figure><h2 id=keyboard>Keyboard<a hidden class=anchor aria-hidden=true href=#keyboard>#</a></h2><p>First we need a dedicated keyboard for this function, and any keyboard should do.</p><p>Laying arround I just have full size keyboard, so I bought a new <code>MITSAI Q20</code> from a local shop.</p><p>I like it, because the keys are squared and low profile. Easy to customize with stickers.</p><h2 id=pluging-keyboard-the-first-time>pluging keyboard the first time<a hidden class=anchor aria-hidden=true href=#pluging-keyboard-the-first-time>#</a></h2><p>In <code>systemd journal</code>, you will find information about the keyboard. As you can see, the brand name from my local shop do not show up anywhere.</p><pre tabindex=0><code>kernel: usb 1-1.4.3: new low-speed USB device number 15 using xhci_hcd
kernel: usb 1-1.4.3: New USB device found, idVendor=1a2c, idProduct=0e24, bcdDevice= 1.10
kernel: usb 1-1.4.3: New USB device strings: Mfr=1, Product=2, SerialNumber=0
kernel: usb 1-1.4.3: Product: USB Keyboard
kernel: usb 1-1.4.3: Manufacturer: SEM
kernel: input: SEM USB Keyboard as /devices/pci0000:00/0000:00:14.0/usb1/1-1/1-1.4/1-1.4.3/1-1.4.3:1.0/0003:1A2C:0E24.000B/input/input29
kernel: hid-generic 0003:1A2C:0E24.000B: input,hidraw5: USB HID v1.10 Keyboard [SEM USB Keyboard] on usb-0000:00:14.0-1.4.3/input0
</code></pre><h1 id=system-configuration>System configuration<a hidden class=anchor aria-hidden=true href=#system-configuration>#</a></h1><h2 id=udev>udev<a hidden class=anchor aria-hidden=true href=#udev>#</a></h2><p><a href=https://www.freedesktop.org/software/systemd/man/udev.html>udev</a> will allow us to do some setup and start actkbd service.</p><p>My <code>udev rule</code> file is:</p><pre tabindex=0><code>ACTION==&#34;add&#34;, \ # match the event, device and parent device
SUBSYSTEM==&#34;input&#34;, \ 
ATTRS{name}==&#34;SEM USB Keyboard&#34;, \
MODE=&#34;0666&#34;, \ # set mode to other read from the device, without root
SYMLINK+=&#34;macrokeyboard&#34;, \ # create a nicer symbolic link
TAG+=&#34;systemd&#34;, \ # this will used systemd to start actkbd
ENV{SYSTEMD_USER_WANTS}=&#34;actkbd.service&#34;
</code></pre><p>To reload the configuration, we can use</p><pre tabindex=0><code class=language-terminal data-lang=terminal>udevadm control --reload-rules 
</code></pre><p>To check if the <code>udev rule</code> file is working</p><pre tabindex=0><code class=language-terminal data-lang=terminal>udevadm test /devices/pci0000:00/0000:00:14.0/usb1/1-1/1-1.4/1-1.4.3/1-1.4.3:1.0/0003:1A2C:0E24.000B/input/input29
</code></pre><p>To create an <code>udev rule</code> can be hit and miss. Doing the wrong filters, can lead to diferent devices be found, but is is possible to get all information</p><pre tabindex=0><code class=language-terminal data-lang=terminal>udevadm info --attribute-walk --path /devices/pci0000:00/0000:00:14.0/usb1/1-1/1-1.4/1-1.4.3/1-1.4.3:1.0/0003:1A2C:0E24.000B/input/input29
</code></pre><p>In case of problems, read <a href=reactivated.net/writing_udev_rules.html>Writing udev rules</a> to learn how to write it.</p><h2 id=systemd>systemd<a hidden class=anchor aria-hidden=true href=#systemd>#</a></h2><p>As configured in <code>udev rule</code>, this unit will start the service.</p><pre tabindex=0><code>[Unit]
Description=Actkbd: Daemon for X-independent shortcuts
ConditionPathIsSymbolicLink=/dev/macrokeyboard

[Service]
Environment=DISPLAY=:0
ExecStart=actkbd --device /dev/macrokeyboard --daemon --pidfile /tmp/actkbd.pid
Type=forking
PIDFile=/tmp/actkbd.pid
Restart=on-failure
RestartSec=1
</code></pre><h2 id=x>X<a hidden class=anchor aria-hidden=true href=#x>#</a></h2><p>Without instrcut XOrg to ignore this numeric keypad, when we press a key, it will send that key code the application.</p><p>So we need to place a file in <code>/usr/share/X11/xorg.conf.d/</code>, with:</p><pre tabindex=0><code>Section &#34;InputClass&#34;
  Identifier &#34;Ignore macro keyboard&#34;
  MatchProduct &#34;SEM USB Keyboard&#34;
  Option &#34;Ignore&#34; &#34;on&#34;
EndSection
</code></pre><p>To test this, it is needed to restart X server&mldr;</p><h2 id=actkbd>actkbd<a hidden class=anchor aria-hidden=true href=#actkbd>#</a></h2><p><a href=https://github.com/thkala/actkbd/issues/2#issuecomment-264657080>Warning</a>, by project author:</p><blockquote><p>&mldr;but here&rsquo;s the catch: actkbd (a) is single-threaded and (b) uses
system() in the same thread to execute commands. Yes, I know, not
nice; the whole program is basically a hack - it just worked well
enough for me and a few friends back when I wrote it.</p></blockquote><p>It can be an hack, but <a href=https://github.com/thkala/actkbd>actkbd</a> have work without problems for me.</p><p>After installation we need to find the keycodes from our keyboard.</p><h3 id=keycodes>KeyCodes<a hidden class=anchor aria-hidden=true href=#keycodes>#</a></h3><p>I&rsquo;ve found two ways to do it&mldr;</p><p>using <code>actkbd</code></p><pre tabindex=0><code>$ actkbd --showexec --showkey --noexec --device /dev/macrokeyboard
Keys: 79
Keys: 80
Keys: 81
Keys: 96
</code></pre><p>or using <code>showkeys</code></p><pre tabindex=0><code>$ sudo showkey 
press any key (program terminates 10s after last keypress)...
keycode  28 release
keycode  79 press
keycode  79 release
keycode  80 press
keycode  80 release
</code></pre><h3 id=configuration>configuration<a hidden class=anchor aria-hidden=true href=#configuration>#</a></h3><p>The default location for the configuration file is <code>/etc/actkbd.conf</code></p><p>I opted by send all keycodes to a single script&mldr;</p><pre tabindex=0><code>    #1st line
    172:::/usr/bin/keyboardScript.sh 172 &amp;
     15:::/usr/bin/keyboardScript.sh 15 &amp;
    155:::/usr/bin/keyboardScript.sh 155 &amp;
    140:::/usr/bin/keyboardScript.sh 140 &amp;
</code></pre><p>Each line can execute any command, but I decided to have a script which will deal with all of it&mldr; it is easier to reuse code and maintain it. Also, I can change the script without to bother to restart actkbd to reload new actions.</p><h3 id=testing>testing<a hidden class=anchor aria-hidden=true href=#testing>#</a></h3><pre tabindex=0><code class=language-terminal data-lang=terminal>actkbd --showexec --showkey --device /dev/macrokeyboard
</code></pre><p>It should show somethig like</p><pre tabindex=0><code>Keys: 76
Executing: /home/fcarvalho/bin/keyboardScript.sh 76 &amp;
Keys: 69
Executing: /home/fcarvalho/bin/keyboardScript.sh 69 &amp;
</code></pre><h1 id=the-script>The Script<a hidden class=anchor aria-hidden=true href=#the-script>#</a></h1><p>My <a href=https://github.com/flippipe/macro-keyboard/blob/main/keyboardScript.sh>script</a>, is a giant <code>case</code>, something like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>case</span> $1 in
</span></span><span style=display:flex><span>    79<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>        <span style=color:#75715e># xdotool key U1f600</span>
</span></span><span style=display:flex><span>        xdotool type üòÄ
</span></span><span style=display:flex><span>        <span style=color:#75715e># slow https://github.com/jordansissel/xdotool/issues/10</span>
</span></span><span style=display:flex><span>    ;;
</span></span><span style=display:flex><span>    71<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    mpc status | grep playing 2&gt;&amp;<span style=color:#ae81ff>1</span> &gt; /dev/null
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $? -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># it is playing</span>
</span></span><span style=display:flex><span>        mpc --quiet stop
</span></span><span style=display:flex><span>        dbusSend Pause
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> 
</span></span><span style=display:flex><span>        mpc --quiet play
</span></span><span style=display:flex><span>        dbusSend Play
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    ;;
</span></span><span style=display:flex><span>    76<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># take a area screenshot</span>
</span></span><span style=display:flex><span>        flameshot gui &amp;
</span></span><span style=display:flex><span>    ;;
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>...<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>and several tools were used</p><h2 id=xdotool>xdotool<a hidden class=anchor aria-hidden=true href=#xdotool>#</a></h2><p>Without <a href=https://manpages.ubuntu.com/manpages/focal/man1/xdotool.1.html>xdotool</a> it cloud not do the automations.</p><p>xdotool lets us programmatically simulate keyboard input and mouse.</p><p>As example, pressing a key to toggle video in <code>MS Teams</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>82<span style=color:#f92672>)</span> <span style=color:#75715e># mute unmute video</span>
</span></span><span style=display:flex><span>    WID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>xdotool search --onlyvisible --name <span style=color:#e6db74>&#34;Microsoft Teams&#34;</span><span style=color:#66d9ef>)</span> ‚ë†
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $WID <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        xdotool windowfocus --sync $WID ‚ë°
</span></span><span style=display:flex><span>        xdotool key --window $WID <span style=color:#e6db74>&#34;ctrl+shift+o&#34;</span> ‚ë¢
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>;;
</span></span></code></pre></div><p>where:</p><ul><li>‚ë† Search for Teams window</li><li>‚ë° Put the window on focus</li><li>‚ë¢ Send the Teams shortcut to Toggle video</li></ul><h2 id=mpc>mpc<a hidden class=anchor aria-hidden=true href=#mpc>#</a></h2><p>My music is streamed from other machine, where I&rsquo;ve <a href=https://www.musicpd.org/>mpd</a> running, so I use <a href=https://www.musicpd.org/clients/mpc/>mpc</a> to control it remotelly.</p><h2 id=dbus>dbus<a hidden class=anchor aria-hidden=true href=#dbus>#</a></h2><p><a href=https://manpages.ubuntu.com/manpages/focal/en/man1/dbus-send.1.html>dbus-send</a> + <a href=https://specifications.freedesktop.org/mpris-spec/2.2/Player_Interface.html>MPRIS</a> allow to abstract which music player I&rsquo;m using, as long as they support it.</p><p><em>note</em> use <a href=https://wiki.gnome.org/Apps/DFeet>d-feet</a> to explore dbus</p><h1 id=final-result>Final Result<a hidden class=anchor aria-hidden=true href=#final-result>#</a></h1><p>Besides the software, the final touch was to print in photo papper some nice icons. Then with double face tape and a scissor, convert them to little stickers.</p><p>All the files are in <a href=https://github.com/flippipe/macro-keyboard>Building a macro keyboard</a>.</p><h1 id=future>Future<a hidden class=anchor aria-hidden=true href=#future>#</a></h1><p>Most of this work was done with xdotool, on top X&mldr; which is being substituted by Wayland.</p><p>So, it is time to look into xdotool replacement options:</p><ul><li><a href=https://github.com/ReimuNotMoe/ydotool>https://github.com/ReimuNotMoe/ydotool</a></li><li><a href=https://github.com/atx/wtype>https://github.com/atx/wtype</a></li></ul><h4 id=other-resources>other resources<a hidden class=anchor aria-hidden=true href=#other-resources>#</a></h4><p><a href=https://fontawesome.com/>Font Awesome</a> or <a href=https://www.nerdfonts.com/>Nerd Fonts</a></p><p><a href=http://jasonwryan.com/blog/2014/01/20/udev/>Scripting with udev</a></p><p><a href=https://www.freedesktop.org/software/systemd/man/systemd.service.html>Service unit configuration</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://flippipe.github.io/tags/keyboard/>keyboard</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Building a Macro Keyboard on telegram" href="https://telegram.me/share/url?text=Building%20a%20Macro%20Keyboard&url=https%3a%2f%2fflippipe.github.io%2fposts%2fbuilding-a-macro-keyboard%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://flippipe.github.io>œú’¨◊ïœÅ Œ°Œπ—ÄŒµ</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement('button');e.classList.add('copy-code'),e.innerText='copy';function s(){e.innerText='copied!',setTimeout(()=>{e.innerText='copy'},2e3)}e.addEventListener('click',o=>{if('clipboard'in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand('copy'),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>